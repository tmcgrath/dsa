<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]>
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<![endif]-->
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Asciidoctor 1.5.2" name="generator">
<title>DS220: Data Modeling</title>
<style>/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0;}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{color:rgba(0,0,0,.8); background:#fafafa;padding:0;margin:0;font-family:"Helvetica Neue",  helvetica, arial, verdana, sans-serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Helvetica Neue", helvetica, arial,sans-serif;font-weight:300;font-style:normal;color:#BC5E2E;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header {background: url('deck.js/themes/style/images/bg-pattern-blue.png') bottom left; color: #F8F7F6; text-align: center; min-height: 320px; padding: 30px 0;}
	#header .brand {width: 225px; height: 69px; background-size: 225px 69px; margin: 1em auto; background:url('deck.js/themes/style/images/academy-logo-white.svg') no-repeat;}
	#header>h1 {color: #F8F7F6; font-size: 3.75em;; margin-top: .5em;}
#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em;}
#content:before{content:none}
	#content .sect1 h2 {color: #374c51; font-weight: 300; text-align: center;}
	#content .sect1 {}
	.sect1{padding-bottom:.625em}
	@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
	.sect1+.sect1{}

	.sect1 h4 {color: #22836A;}
	.sect h4 strong {font-weight: bold;}
	.sectionbody  {background: white; border-radius: 3px; padding: 1.5em;}
	.sectionbody ol {list-style-position: inside; margin-left: 0;}
	.sectionbody ol li {border-bottom: 1px solid #ebeee8;}
	.sectionbody ol li:hover {background: #fafafa;}
	.sectionbody ol li p {margin-bottom: 0;}
	.sectionbody ol li a {text-decoration: none; color: #374c51; display: block; padding: 1em;}

#header>h1:first-child{color: #F8F7F6;margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}

#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#BC5E2E;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
/*.admonitionblock {margin: 1.5em 0;}
   	.admonitionblock.note .icon-note::before, .admonitionblock .tip .icon-tip::before {content: "\ea0c"; color: #1B7387;}
    .admonitionblock.important .icon-important::before {content: "\ea07"; color: #22836A;}
    .admonitionblock.warning .icon-warning::before {content: "\f08f"; color: #BC5E2E;}
    .admonitionblock.caution .icon-caution::before {content: "\ea08"; color: #D2A854;}
    .admonitionblock .icon {font-size: 3.5em; padding: .25em; border-right: 3px solid #E3E4E3;}
    .admonitionblock .content {vertical-align: middle; padding: .25em;}
*/


.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}</style>
<style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style>
</head>
<body class="article">
<div id="header">
<div class="brand"></div>
<h1>DS220: Data Modeling</h1>
</div>
<div id="content">
<div class="sect3">
<h4 id="EXERCISE-1">Exercise 1: Setting Up The Lab Environment</h4>

</div>
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Setup the virtual machine for this course</p>
</li>
<li>
<p>Familiarize yourself with <code>cqlsh</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong"><strong><em>Steps</em></strong></h3>
<div class="sect3">
<h4 id="strong-start-the-lab-virtual-machine-strong"><strong>Start the lab virtual machine</strong></h4>
<div class="paragraph">
<p>1) Verify that your system has Oracle VM VirtualBox Manager or other virtual machine software installed.</p>
</div>
<div class="paragraph">
<p>2) Extract the instructor-provide .zip file to a convenient location.</p>
</div>
<div class="paragraph">
<p>3) Open the directory created and double-click on the VM file that works with your virtual machine software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is either <code>DS220.vbox</code> for VirtualBox, or <code>DS220.vmx</code> for VMware. If you have any other virtualization software installed, you will need to know how to create a new virtual machine and add the <code>box-disk1.vmdk</code> disk image.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4) Start the VM and verify the virtual machine has launched.  You should see a desktop with icons on the left.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="vm desktop" src="images/courses/DS220/data-modeling/overview/vm-desktop.jpg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="strong-run-cqlsh-strong"><strong>Run cqlsh</strong></h4>
<div class="paragraph">
<p>1) On the VM desktop, open the command-line Terminal.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="vm terminal" src="images/courses/DS220/data-modeling/overview/vm-terminal.jpg">
</div>
</div>
<div class="paragraph">
<p>2) Start the Cassandra tool <code>cqlsh</code>. You can run <code>cqlsh</code> or any Cassandra / DSE tool from any directory because they are in your <code>$PATH</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If <code>cqlsh</code> is not able to connect to DataStax Enterprise, use the command <code>service dse status</code> to see if DSE is running. If for some reason DSE is not running, you can start it with <code>service dse start</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>3) In <code>cqlsh</code>, note the prompt header changed to <code>cqlsh&gt;</code> indicating further commands are for <code>cqlsh</code> instead of the Linux shell.</p>
</div>
<div class="paragraph">
<p>4) Execute the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> * <span class="keyword">FROM</span> system.schema_keyspaces;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cqlsh</code> displays the results immediately. Notice the built-in keyspaces. Your cqlsh environment is working correctly.</p>
</div>
<div class="paragraph">
<p>5) Type <code>exit</code> to quit <code>cqlsh</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-2">Exercise 2: Challenge 1&#8212;&#8203;Adding a keyspace and table</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create a keyspace for KillrVideo</p>
</li>
<li>
<p>Create a table to store video metadata</p>
</li>
<li>
<p>Load the data for the video table from a CSV file</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Welcome to the KillrVideo company! KillrVideo hired you to build the latest and greatest video sharing application on the Internet. Your task is to ramp up on the domain and become acquainted with Cassandra. To start, you decided to look into creating a table schema and to load some video data.</p>
</div>
<div class="paragraph">
<p>The video metadata is made up of:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeuuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-2"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) If necessary, launch the provided training VM and open a Terminal window.</p>
</div>
<div class="paragraph">
<p>2) Open  <code>/root/labwork/exercise-2/videos.csv</code> with a text editor and review the contents of the file.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Notice the order of the columns matches the order shown above.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>3) Open a terminal and navigate to the <code>/root/labwork/exercise-2</code> directory.</p>
</div>
<div class="paragraph">
<p>4) In the Terminal window, start <code>cqlsh</code>.</p>
</div>
<div class="paragraph">
<p>5) In <code>cqlsh</code>, create a keyspace called <code>killrvideo</code> and switch to that keyspace. Use <code>SimpleStrategy</code> for the replication class with a replication factor of one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can press the tab key within the CREATE KEYSPACE command to have <code>cqlsh</code> autocomplete the replication parameters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>6) Create a single table called <code>videos</code> with the same structure as shown above. <code>video_id</code> is the primary key.</p>
</div>
<div class="paragraph">
<p>7) Load the newly created table with the <code>videos.csv</code> file using the <code>COPY</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Notice COPY does not require column names when the target table schema and source CSV file columns match respectively. We will see more on table schema later.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>8) Use SELECT to verify the data loaded correctly. Include LIMIT to retrieve only the first 10 rows.</p>
</div>
<div class="paragraph">
<p>9) Use SELECT to COUNT(*) the number of imported rows. It should match the number of rows COPY reported as imported.</p>
</div>
<div class="paragraph">
<p>10) Exit <code>cqlsh</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-3">Exercise 3: Challenge 2&#8212;&#8203;Composite Partition Keys</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong-2"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create a new table that allows querying videos by title and year using a composite partition key</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-2"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Your peers need to query videos based on <code>title</code> and <code>added_year</code>. The new columns for this table are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_year</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-3"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Use a text editor to view the <code>labwork/exercise-3/videos_by_title_year.csv</code> file.</p>
</div>
<div class="paragraph">
<p>2) Open Terminal and navigate to <code>labwork/exercise-3/</code>.</p>
</div>
<div class="paragraph">
<p>3) Start <code>cqlsh</code> and create a second table in the <code>killrvideo</code> keyspace called <code>videos_by_title_year</code> with the above structure. Be sure users can query this table on both <code>title</code> and <code>added_year</code> by combining them into the partition key.</p>
</div>
<div class="paragraph">
<p>4) Load the data from the <code>videos_by_title_year.csv</code> file using the <code>COPY</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos_by_title_year <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos_by_title_year.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Try running queries on the <code>videos_by_title_year</code> table to query on a specific <code>title</code> and <code>added_year</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">title</th>
<th class="tableblock halign-left valign-top">added_year</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Introduction To Apache Cassandra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sleepy Grumpy Cat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grumpy Cat: Slow Motion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AzureDev</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>7) What error does Cassandra return when you try to query on just title or just year? Why?</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-4">Exercise 4: Challenge 3&#8212;&#8203;Clustering Columns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong-3"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create a <code>videos_by_tag_year</code> table that allows range scans and ordering by year</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-3"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>There have been some interesting wrinkles in your quest to understand how Cassandra and CQL work. Although you have been able to complete your tasks to the letter, your team cannot query based on tag and year. Fortunately, your new understanding of clustering columns will help to improve your design. You decide to build a table that allows querying by <code>tag</code> and <code>added_year</code>. The columns are as follows:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_year</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-4"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) In your terminal, navigate to <code>labwork/exercise-4</code> directory. Launch <code>cqlsh</code> and switch to the <code>killrvideo</code> keyspace.</p>
</div>
<div class="paragraph">
<p><span class="image"><img alt="ninja" src="images/courses/DS220/data-modeling/data-modeling-wins/challenge-3/ninja.jpg" width="40%"></span></p>
</div>
<div class="paragraph">
<p>2) To become an upsert ninja, create the following (bad) table with the (crummy) primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> bad_videos_by_tag_year (
  tag <span class="predefined-type">text</span>,
  added_year <span class="predefined-type">int</span>,
  added_date <span class="predefined-type">timestamp</span>,
  title <span class="predefined-type">text</span>,
  description <span class="predefined-type">text</span>,
  user_id uuid,
  video_id timeuuid,
  <span class="directive">PRIMARY</span> <span class="type">KEY</span> ((video_id))
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) As an aside, use DESCRIBE TABLE to view the structure of your <code>bad_videos_by_tag_year</code> table.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Notice the column order differs from the CREATE TABLE statement. Cassandra orders columns by partition key, clustering columns (shown later), and then alphabetical order of the remaining columns.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4) Execute the following COPY command to import <code>videos_by_tag_year.csv</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY bad_videos_by_tag_year (tag, added_year, video_id, added_date, description, title, user_id) <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos_by_tag_year.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We must explicitly list the column names because this table schema no longer matches the CSV structure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note the number of imported rows. Now COUNT() the number of rows in the <code>bad_videos_by_tag_year</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="predefined">COUNT</span>(*)
<span class="keyword">FROM</span> bad_videos_by_tag_year;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the number of rows in the <code>bad_videos_by_tag_year</code> does not match the number of rows imported from <code>videos_by_tag_year.csv</code>. Since <code>videos_by_tag_year.csv</code> duplicates <code>video_id</code> for each unique <code>tag</code> and <code>year</code> per video, Cassandra upserted several records during the COPY. <code>video_id</code> is not a proper partition key for this scenario.</p>
</div>
<div class="paragraph">
<p>5) Drop your nasty table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">DROP</span> <span class="type">TABLE</span> bad_videos_by_tag_year;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your mission is to restructure your table and allow users to query on <code>tag</code> and possible <code>added_year</code> ranges while avoiding upserts on import. You must also return your results in descending order of year.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image" style="float: right"><img alt="mission" src="images/courses/DS220/data-modeling/data-modeling-wins/challenge-3/mission.jpg" width="30%"></span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-5"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Create a table with the columns above to facilitate querying for videos by tag within a given year range returning the results in descending order by year. We wrote most of the CREATE TABLE for you. Fill in the PRIMARY KEY and CLUSTERING ORDER BY.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> videos_by_tag_year (
  tag <span class="predefined-type">text</span>,
  added_year <span class="predefined-type">int</span>,
  video_id timeuuid,
  added_date <span class="predefined-type">timestamp</span>,
  description <span class="predefined-type">text</span>,
  title <span class="predefined-type">text</span>,
  user_id uuid,
  <span class="directive">PRIMARY</span> <span class="type">KEY</span> ( )
) WITH CLUSTERING <span class="keyword">ORDER</span> <span class="keyword">BY</span> ( );</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Load the data from the <code>videos_by_tag_year.csv</code> file in the provided <code>exercise-4</code> directory using the COPY command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos_by_tag_year <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos_by_tag_year.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Check the number of rows in the <code>videos_by_tag_year</code> table.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The number of rows should match the number of rows imported by the COPY command. If not, you had upserts again and will need to adjust your PRIMARY KEY. Ask your instructor for help if necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>6) Try running queries on the <code>videos_by_tag_year</code> table to query on a specific tag and added year.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">tag</th>
<th class="tableblock halign-left valign-top">added_year</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trailer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2015</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>7) Try querying for all videos with tag "cql" added before the year 2015. Notice you can do range queries on clustering columns.</p>
</div>
<div class="paragraph">
<p>8) Try querying for all videos added before 2015. The query will fail. What error message does cqlsh report? Why did the query fail whereas the previous query worked?</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-5">Exercise 5: Challenge 4&#8212;&#8203;Adding Tags and Video Encoding</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong-4"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create a user defined type</p>
</li>
<li>
<p>Alter an existing table and add additional columns</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-4"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>After reviewing your design of the tables that support tag and year queries, your manager happened to remember that there isn&#8217;t a <code>tags</code> column in the original table that stores video metadata. You have now been asked to include that in the videos table schema and also to add another column to store video encoding information.</p>
</div>
<div class="paragraph">
<p>The revised <code>videos</code> table schema:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeuuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_encoding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set&lt;text&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The encoding data structure:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bit_rates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set&lt;text&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">height</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-6"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Use a text editor to open and review the <code>videos.csv</code> file in the <code>labwork/exercise-5</code> directory. Notice the addition of the <code>tags</code> column. Also open and review the <code>videos_encoding.csv</code> file.</p>
</div>
<div class="paragraph">
<p>2) In Terminal, navigate to <code>labwork/exercise-5</code>. Launch <code>cqlsh</code> and switch to the <code>killrvideo</code> keyspace.</p>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img alt="erase" src="images/courses/DS220/data-modeling/data-modeling-wins/challenge-4/erase.jpg" width="25%"></span></p>
</div>
<div class="paragraph">
<p>3) Run the TRUNCATE command to erase the data from the <code>videos</code> table.</p>
</div>
<div class="paragraph">
<p>4) Alter the <code>videos</code> table to add a <code>tags</code> column.</p>
</div>
<div class="paragraph">
<p>5) Load the data from the <code>videos.csv</code> file using the COPY command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Create a user defined type called <code>video_encoding</code> with the structure given above.</p>
</div>
<div class="paragraph">
<p>7) Alter your table to add an <code>encoding</code> column of the <code>video_encoding</code> type.</p>
</div>
<div class="paragraph">
<p>8) Load the data from the <code>videos_encoding.csv</code> file using the COPY command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos (video_id, encoding) <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos_encoding.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>9) Run a query to retrieve the first 10 rows of the <code>videos</code> table.</p>
</div>
<div class="paragraph">
<p>Notice the altered table contains data for the new <code>tags</code> and <code>encoding</code> column.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-6">Exercise 6: Challenge 5&#8212;&#8203;Using Counters In CQL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong-5"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create a new table that makes use of the counter type</p>
</li>
<li>
<p>Load the newly created table with data</p>
</li>
<li>
<p>Run queries against the table to test counter functionality</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-5"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>You have been on a roll lately designing tables, and that hasn&#8217;t gone unnoticed. Since no good deed goes unpunished, your team has unanimously agreed to let you tackle one of the trickier problems they encountered learning Cassandra.</p>
</div>
<div class="paragraph">
<p>The problem is with keeping track of the number of videos in a particular category. Whenever a tag is added to a video, a transaction is done which reads the number of videos for that video category, increments it by one, and updates it in the database. However, this technique is susceptible to race conditions. Cassandra is a distributed database that allows for concurrent, simultaneous operations, and it does not allow transactions. Your team has been stumped on how to get this functionality working correctly in Cassandra. Fortunately, you have just read up on the counter type and know that it is the perfect way to solve this problem.</p>
</div>
<div class="paragraph">
<p>The requirement itself is to be able to support a query that can retrieve the number of videos for a particular category, defined as a specific tag and year added. The query allows querying on a tag, and optionally, on a range for the added year.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-7"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Navigate to <code>labwork/exercise-6</code> and open the <code>videos_count_by_tag.cql</code> file and review its contents. Notice this is a CQL script rather than a CSV data file.</p>
</div>
<div class="paragraph">
<p>2) In your Terminal, go to the <code>labwork/exercise-6</code> directory.</p>
</div>
<div class="paragraph">
<p>3) Launch <code>cqlsh</code> and switch to <code>killrvideo</code> keyspace.</p>
</div>
<div class="paragraph">
<p>4) Create a new table called <code>videos_count_by_tag</code> with a column <code>video_count</code> which makes use of a counter type to store the video count. Structure your table to work correctly with the CQL in <code>videos_count_by_tag.cql</code>.</p>
</div>
<div class="paragraph">
<p>5) Load the number of counts from the <code>videos_count_by_tag.cql</code> file into the <code>videos_count_by_tag</code> table using the SOURCE command.</p>
</div>
<div class="paragraph">
<p>6) Run a query to display each category of tag and added year, along with the count of videos for each.</p>
</div>
<div class="paragraph">
<p>7) Simulate adding another a tag for another video by incrementing the video count for a category, and then querying the new count from the <code>videos_count_by_tag</code> table.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-7">Exercise 7: Challenge 6&#8212;&#8203;Denormalized Tables</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong-6"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create tables to support querying for videos by actor or genre</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-6"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>With all of the success you&#8217;ve been having on the video sharing development team, you have been promoted and assigned to work on a high-priority project to incorporate movie content into the KillrVideo application.</p>
</div>
<div class="paragraph">
<p>Your new team is normalizing their video and actor metadata into separate tables and currently are stuck figuring out how to join tables in Cassandra. Having been around the Cassandra block a few times, you know that JOINs are expensive and not supported. It is up to you to show your team the optimal way of performing these queries.</p>
</div>
<div class="paragraph">
<p>The video metadata is similar to what was in the video sharing domain:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeuuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_encoding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set&lt;text&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is also the additional following metadata:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">actor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">character</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">genre</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With this metadata, the data model must support the following queries:</p>
</div>
<div class="paragraph">
<p><strong>Q1</strong>: Retrieve videos an actor has appeared in (newest first).</p>
</div>
<div class="paragraph">
<p><strong>Q2</strong>: Retrieve videos within a particular genre (newest fist).</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-8"><strong><em>Steps</em></strong></h3>
<div class="sect3">
<h4 id="strong-create-a-videos_by_actor-table-strong"><strong>Create a videos_by_actor table</strong></h4>
<div class="paragraph">
<p>1) In <code>cqlsh</code>, create a new table called <code>videos_by_actor</code> which will support query <strong>Q1</strong>. We provided most of the CREATE TABLE for you except the PRIMARY KEY.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> videos_by_actor (
  actor <span class="predefined-type">text</span>,
  added_date <span class="predefined-type">timestamp</span>,
  video_id timeuuid,
  character_name <span class="predefined-type">text</span>,
  description <span class="predefined-type">text</span>,
  encoding frozen&lt;video_encoding&gt;,
  tags <span class="class">set</span>&lt;<span class="predefined-type">text</span>&gt;,
  title <span class="predefined-type">text</span>,
  user_id uuid,
  <span class="directive">PRIMARY</span> <span class="type">KEY</span> ( )
) WITH CLUSTERING <span class="keyword">ORDER</span> <span class="keyword">BY</span> ( );</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Load <code>videos_by_actor.csv</code> into the <code>videos_by_actor</code> table using the COPY command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cql">COPY videos_by_actor FROM 'videos_by_actor.csv' WITH HEADER = true;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Run a query to retrieve the video information for a particular actor (Tom Hanks, Denzel Washington, or see if your favorite actor is in there).</p>
</div>
<div class="paragraph">
<p>4) Try SELECTing just the actor and the added_date columns. Notice the order of added_dates.</p>
</div>
</div>
<div class="sect3">
<h4 id="strong-create-a-videos_by_genre-table-strong"><strong>Create a videos_by_genre table</strong></h4>
<div class="paragraph">
<p>1) In <code>cqlsh</code>, create a new table called <code>videos_by_genre</code> which will support query <strong>Q2</strong>. We provided most of the CREATE TABLE for you except the PRIMARY KEY.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> videos_by_genre (
  genre <span class="predefined-type">text</span>,
  added_date <span class="predefined-type">timestamp</span>,
  video_id timeuuid,
  description <span class="predefined-type">text</span>,
  encoding frozen&lt;video_encoding&gt;,
  tags <span class="class">set</span>&lt;<span class="predefined-type">text</span>&gt;,
  title <span class="predefined-type">text</span>,
  user_id uuid,
  <span class="directive">PRIMARY</span> <span class="type">KEY</span> ( )
) WITH CLUSTERING <span class="keyword">ORDER</span> <span class="keyword">BY</span> ( );</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Load <code>videos_by_genre.csv</code> into the <code>videos_by_genre</code> table using the COPY command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cql">COPY videos_by_genre FROM 'videos_by_genre.csv' WITH HEADER = true;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Run a query to retrieve the video information for a particular genre (Future noir, Time travel).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-8">Exercise 8: Final Challenge</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-challenge-you-will-strong-7"><strong>In this challenge, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Attempt to enhance your data model to meet the new requirements of KillrVideo</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-7"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Excited by the progress that has been made on the data modeling for this project, the product team has started adding more and more user features. You have been tasked with ensuring that all of these requirements for these user features can be met with the data model that is being designed.</p>
</div>
<div class="sect3">
<h4 id="roadmap">Roadmap:</h4>
<div class="imageblock">
<div class="content">
<img alt="killrvideo roadmap" src="images/courses/DS220/data-modeling/data-modeling-wins/challenge-final/killrvideo-roadmap.svg">
</div>
</div>
</div>
<div class="sect3">
<h4 id="queries">Queries:</h4>
<div class="paragraph">
<p><strong>Q1</strong>: Find a user with a specified email</p>
</div>
<div class="paragraph">
<p><strong>Q2</strong>: Find most recently uploaded videos</p>
</div>
<div class="paragraph">
<p><strong>Q3</strong>: Find a user with a specified user id</p>
</div>
<div class="paragraph">
<p><strong>Q4</strong>: Find videos uploaded by a user with a known id (show most recently uploaded videos first)</p>
</div>
<div class="paragraph">
<p><strong>Q5</strong>: Find comments posted by a user with a known id (show most recently posted comments first)</p>
</div>
<div class="paragraph">
<p><strong>Q6</strong>: Find comments posted for a video with a known id (show most recent comments first)</p>
</div>
<div class="paragraph">
<p><strong>Q7</strong>: Find an average rating with a known id (show most recent comments first)</p>
</div>
<div class="paragraph">
<p><strong>Q8</strong>: Find a video with a specified video id</p>
</div>
<div class="paragraph">
<p><strong>Q9</strong>: Find trailers for a video with a known id (show title in ascending order)</p>
</div>
<div class="paragraph">
<p><strong>Q10</strong>: Find video interactions for a user with a known id and specified video id (show most recent interactions first)</p>
</div>
<div class="paragraph">
<p><strong>Q11</strong>: Find actors for a video with a known id (show actor names in ascending order)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-9"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) In your Terminal, launch <code>cqlsh</code> and switch to <code>killrvideo</code> keyspace.</p>
</div>
<div class="paragraph">
<p>2) Beat your head against the wall and cry knowing that you need a better methodology than just "winging it" to build the Cassandra data model to support these queries.</p>
</div>
<div class="paragraph">
<p><span class="image"><img alt="head-wall-bang" src="images/courses/DS220/data-modeling/data-modeling-wins/challenge-final/head-wall-bang.jpg"></span></p>
</div>
<div class="paragraph">
<p>3) Start looking for a new job&#8230;&#8203;OR! attend DataStax DS220!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-9">Exercise 9: Model The KillrVideo Entities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="in-this-exercise-you-will">In this exercise, you will:</h3>
<div class="ulist">
<ul>
<li>
<p>Identify the entity types, relationship types, and attribute types</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-10"><strong><em>Steps</em></strong></h3>
<div class="sect3">
<h4 id="diagram-killrvideo-entities-and-their-attributes">Diagram KillrVideo entities and their attributes</h4>
<div class="paragraph">
<p>Here is a almost complete conceptual model of the KillrVideo domain:</p>
</div>
<div class="paragraph">
<p><span class="image"><img alt="fundamentals\exercise" src="images/cassandra/dev/data-modeling/conceptual/entity-relationship-model/fundamentals/exercise.svg"></span></p>
</div>
<div class="paragraph">
<p>Note the "What else?" areas for both attributes and relationships for <strong>User</strong>. Identify what further attributes would also describe the <strong>User</strong> entity type. Also determine what other relationships are necessary between <strong>User</strong> and <strong>Video</strong>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-10">Exercise 10: Application Workflow And Access Patterns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-2"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Finish the application workflow based KillrVideo query requirements</p>
</li>
<li>
<p>Add the remaining access patterns based on KillrVideo query requirements</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-11"><strong><em>Steps</em></strong></h3>
<div class="imageblock" style="float: left">
<div class="content">
<img alt="killrvideo workflow exercise" src="images/cassandra/dev/data-modeling/application-workflows-and-access-patterns/killrvideo-workflow-exercise.svg">
</div>
</div>
<div class="paragraph">
<p>Using the following KillrVideo tasks, finish filling out the application workflow diagram and access patterns.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find comments posted by a user with a known id (show most recently posted comments first)</p>
</li>
<li>
<p>Find comments posted for a video with a known id (show most recent comments first)</p>
</li>
<li>
<p>Find an average rating with a known video id</p>
</li>
<li>
<p>Find trailers for a video with a known id</p>
</li>
<li>
<p>Find video interactions for a user with a known id and specified video id (show most recent interactions first)</p>
</li>
<li>
<p>Find actors for a video with a known id</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-11">Exercise 11: Extend The KillrVideo Logical Model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-3"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Add tables to the logical model to support additional queries</p>
</li>
<li>
<p>Ensure that the mapping rules are applied appropriately</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-8"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>The KillrVideo product team wants to add additional query capabilities to the application.
Specifically the following queries will need to be supported:</p>
</div>
<div class="paragraph">
<p><strong>Q1.</strong> Find all user videos that match a specific tag (show the most recent uploaded videos first)</p>
</div>
<div class="paragraph">
<p><strong>Q2.</strong> Find all movies that features a specific actor and release year range (show the most recent videos first, and then sorted by title)</p>
</div>
<div class="paragraph">
<p><strong>Q3.</strong> Find all movies that features a specific actor, genre and release year range (show the most recent videos first, and then sorted by title)</p>
</div>
<div class="paragraph">
<p>The conceptual model outlines the available attributes for the appropriate entities and relationships.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="mr exercise conceptual" src="images/cassandra/dev/data-modeling/logical/mapping-rules/mr-exercise-conceptual.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-12"><strong><em>Steps</em></strong></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On paper or in a text editor, create a logical Chebotko diagram that can support Q1.</p>
</li>
<li>
<p>On paper or in a text editor, create a logical Chebotko diagram that can support Q2.</p>
</li>
<li>
<p>On paper or in a text editor, create a logical Chebotko diagram that can support Q3.</p>
</li>
<li>
<p>For each query, answer the following questions:</p>
<div class="ulist">
<ul>
<li>
<p>What entity or relationship type is being stored in a partition or row?</p>
</li>
<li>
<p>What are the key attribute(s) for this table?</p>
</li>
<li>
<p>What attribute is used for the partition key(s) that enabled the equality query?</p>
</li>
<li>
<p>What attribute is used for the cluster column(s) that enables the inequality / range scan?</p>
</li>
<li>
<p>What are the clustering column(s) and ordering that support the required results?</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-12">Exercise 12: Map Additional Requirements For KillVideo</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-4"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Use mapping patterns from the query-driven methodology to design tables for new queries</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-9"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Great news! Due to your excellent work so far with the Apache Cassandra migration, your lead has given you the responsibility of designing the logical model for several additional requirements. This includes modeling data for custom user playlists and user channels.</p>
</div>
<div class="paragraph">
<p>The relevant part of the conceptual data model now looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="mp exercise conceptual" src="images/cassandra/dev/data-modeling/logical/mapping-patterns/mp-exercise-conceptual.svg">
</div>
</div>
<div class="paragraph">
<p>The following queries will need to be supported:</p>
</div>
<div class="paragraph">
<p><strong>Q1.</strong> Find playlists with the specified owner and modified timestamp range (show the most recently modified playlists first)</p>
</div>
<div class="paragraph">
<p><strong>Q2.</strong> Find all channels subscribed to by a specified user (show the channel names in alphabetical order)</p>
</div>
<div class="paragraph">
<p><strong>Q3.</strong> Find all videos that are contained in a specified channel</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-13"><strong><em>Steps</em></strong></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On paper or in a text editor, use a mapping pattern to create a logical Chebotko diagram that can support Q1.</p>
<div class="ulist">
<ul>
<li>
<p>What mapping pattern best matches the requirements for this query?</p>
</li>
<li>
<p>Did the search attributes for this query match the key attributes for the entity / relationship type?</p>
</li>
<li>
<p>What needed to be done to support the range search for modified timestamp?</p>
</li>
<li>
<p>Was there any data nesting done?</p>
</li>
<li>
<p>Would data duplication occur in this table?</p>
</li>
</ul>
</div>
</li>
<li>
<p>On paper or in a text editor, create a logical Chebotko diagram that can support Q2.</p>
<div class="ulist">
<ul>
<li>
<p>What mapping pattern best matches the requirements for this query?</p>
</li>
<li>
<p>Did the search attributes for this query match the key attributes for the entity / relationship type?</p>
</li>
<li>
<p>Were there any columns that made sense to make static?</p>
</li>
<li>
<p>Was there any data nesting done?</p>
</li>
<li>
<p>Would data duplication occur in this table?</p>
</li>
<li>
<p>Were there any attributes that would have had potentially excessive data duplication?</p>
</li>
</ul>
</div>
</li>
<li>
<p>On paper or in a text editor, create a logical Chebotko diagram that can support Q3.</p>
<div class="ulist">
<ul>
<li>
<p>What mapping pattern best matches the requirements for this query?</p>
</li>
<li>
<p>Did the search attributes for this query match the key attributes for the entity / relationship type?</p>
</li>
<li>
<p>Were there any columns that made sense to make static?</p>
</li>
<li>
<p>Was there any data nesting done?</p>
</li>
<li>
<p>Would data duplication occur in this table?</p>
</li>
<li>
<p>Were there any attributes that would have had potentially excessive data duplication?</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-13">Exercise 13: Figuring Out Partition Size</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-5"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Estimate the number of values a partition would generate with a table schema</p>
</li>
<li>
<p>Calculate the approximate size of a partition for a table schema</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-10"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>The database migration project has been proceeding nicely and now the logical data model has pretty much been completed. Your team currently is starting to validate the generated logical data model&#8217;s performance and data size requirements.</p>
</div>
<div class="paragraph">
<p>Today, two members of your team started discussing about the best design to use for a particular table. Unable to come to an agreement, they have asked you to analyze both of their designs and judge which one is the best.</p>
</div>
<div class="paragraph">
<p>The table that your co-workers are working on is the <code>videos_by_user</code> table. One of them has faithfully followed the mapping pattern from the query-driven methodology to create his version of the table.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="videos by user 1" src="images/cassandra/dev/data-modeling/physical/analysis-validation/partition-size/videos-by-user-1.svg">
</div>
</div>
<div class="paragraph">
<p>The other co-worker is a veteran with relational databases and has created a <code>videos_by_user</code> table based on his experience.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="videos by user 2" src="images/cassandra/dev/data-modeling/physical/analysis-validation/partition-size/videos-by-user-2.svg">
</div>
</div>
<div class="paragraph">
<p>They have worked out and both agreed on the expected data usage for this table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The average user uploads about 15 videos</p>
</li>
<li>
<p>Very active users&#8212;&#8203;especially if they run a video channel&#8212;&#8203;would have approximately 500 videos</p>
</li>
<li>
<p>An artificial limit on the number of videos a user can upload is set to 40,000</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data size for each of the columns are:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Size</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uploaded_timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">videoid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">55 bytes (average)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12 bytes (average)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 bytes (average)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preview_thumbnails</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,340 bytes (average)</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="strong-em-steps-em-strong-14"><strong><em>Steps</em></strong></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the formula to estimate the number of values for co-worker #1&#8217;s <code>videos_by_user</code> for an average user, an active user, and the worst case.</p>
</li>
<li>
<p>Use the formula to estimate the number of values for co-worker #2&#8217;s <code>videos_by_user</code> for an average user, an active user, and the worst case.</p>
<div class="ulist">
<ul>
<li>
<p>Based on the analysis of the number of values per partition for each table, which table is more efficient?</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the formula to estimate the data size for co-worker #1&#8217;s <code>videos_by_user</code> for an average user, an active user, and the worst case.</p>
</li>
<li>
<p>Use the formula to estimate the data size for co-worker #2&#8217;s <code>videos_by_user</code> for an average user, an active user, and the worst case.</p>
<div class="ulist">
<ul>
<li>
<p>Based on the analysis of the data size for each table, which table is more efficient?</p>
</li>
<li>
<p>What factor was more important in this analysis, number of values or data size?</p>
</li>
<li>
<p>Overall, which table is the better one to use?</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-14">Exercise 14: Implementing Aggregation In Your Data Model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-6"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Design a logical data model that will be able to store and retrieve aggregated values</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-11"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>During a peer review of an intern&#8217;s work, your team found that the intern created a schema with the assumption that the queries could use aggregate functions.</p>
</div>
<div class="paragraph">
<p>It&#8217;s back to the drawing board, but this time with you working with the hapless intern to come up with a proper design.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Requirement #1: KillrVideo must be able to count the number of views for each video in a particular month and year. The count does not have to be 100% accurate.</p>
</li>
<li>
<p>Requirement #2: KillrVideo must be able to keep track of the total number of uploaded videos, the combined duration (in seconds) of all of these videos, and the average duration (in seconds) of an uploaded video. These statistics must be stored per day. They do not have to be 100% accurate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A logical table schema for the <code>Video</code> entity has already been created and looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="videos" src="images/cassandra/dev/data-modeling/physical/analysis-validation/data-aggregation/videos.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-15"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Review the above requirement #1.</p>
</div>
<div class="paragraph">
<p>The intern made a table to log an entry into whenever a user views a video. The original query would have then used the COUNT aggregate to retrieve the number of views for a particular video.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As far as Cassandra is concerned, what is inefficient about the intern&#8217;s design?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>2) Come up with an optimal table schema that meets this requirement using Cassandra.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What would be the query that can retrieve the count of the number of views for a video for a particular year and month?</p>
</li>
<li>
<p>Is it possible to retrieve the all-time number of views for a video? If possible, what would be the query?</p>
</li>
<li>
<p>Is there anything that needs to be done from the application side?</p>
</li>
<li>
<p>How would your design increment a video&#8217;s view count? Provide the queries and/or write statements needed to do this.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>3) The intern, being ever helpful, suggested that it would be useful to also display the top 10 videos for each month, based on the number of views.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Would it be possible to query this information in Cassandra? Why or why not?</p>
</li>
<li>
<p>If not, is there a way to do this outside of Cassandra using your schema?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>4) Review the above requirement #2.</p>
</div>
<div class="paragraph">
<p>5) Modify the existing Videos table and/or come up with your own table schema that will meet these requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What is the query to retrieve the total number of uploaded videos?</p>
</li>
<li>
<p>What is the query to retrieve the combined duration of all uploaded videos?</p>
</li>
<li>
<p>What is the query to get the average duration of an uploaded video?</p>
</li>
<li>
<p>Explain how these values are updated whenever a new video is uploaded.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-15">Exercise 15: Table Optimizations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-7"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Determine what tables might benefit from splitting partitions</p>
</li>
<li>
<p>Determine what tables might benefit from splitting tables</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-12"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>The KillrVideo data model is just about finished and your team is reviewing the schema before creating and testing the schema on the Cassandra cluster. You have been assigned to take a look at some of the table diagrams and to analyze whether any further optimization is necessary.</p>
</div>
<div class="imageblock">
<div class="content">
<img alt="videos" src="images/cassandra/dev/data-modeling/physical/table-optimizations/videos.svg">
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="videos by user" src="images/cassandra/dev/data-modeling/physical/table-optimizations/videos-by-user.svg">
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="comments by user" src="images/cassandra/dev/data-modeling/physical/table-optimizations/comments-by-user.svg">
</div>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-16"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) In the <code>videos</code> table, there is some concern that the <code>preview_thumbnails</code> column might make partitions too large to be manageable. The column contains screen capture images from videos, with one screenshot for every 20 seconds in the video. The average screenshot is about 20 KB and the longest expected video would be 6 hours.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What would be the estimated size of the column for the worst case of having a 6 hour video?</p>
</li>
<li>
<p>Is this table a good candidate for splitting partitions?</p>
</li>
<li>
<p>If the table is a candidate, what would be a viable way to split the partitions?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>2) The <code>videos_by_user</code> table also has the same <code>preview_thumbnails</code> column, but in this case there may be multiple videos nested within a user partition. A user may upload several to hundreds of videos, which means that the thumbnail images would all need to be stored in that one partition.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assume that in the worst case, any individual user may upload 500 videos. What would the total size of the <code>preview_thumbnails</code> column by for that partition?</p>
</li>
<li>
<p>Is this table a good candidate for splitting partitions?</p>
</li>
<li>
<p>If the table is a candidate, what would be a viable way to split the partitions?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>3) The last table to consider is the <code>comments_by_user</code> table. As before, there is a <code>preview_thumbnails</code> column. However this table stores all of the comment and video information for a user in a partition. A user may foreseeably comment on hundreds of videos, which gets stored in one partition along with those preview thumbnail images.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The partitions will probably be too large, we will consider splitting the data up in some way.</p>
</li>
<li>
<p>Are there any viable ways to split the partitions in the <code>comments_by_user</code> table?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>4) One other possibility may be to split the table itself.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What columns would remain in the <code>comments_by_user</code> table, and what columns will move to a different table?</p>
</li>
<li>
<p>What would be the queries that can be used to access the columns in each of the tables?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-16">Exercise 16: Finalizing Physical Data Modeling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-8"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Add data types to the physical data model</p>
</li>
<li>
<p>Run the CQL CREATE TABLE statements for each table in physical model</p>
</li>
<li>
<p>Load data and run some queries to test the physical data model</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-13"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>In this exercise, you will build on your logical data model and finalize your physical data model.  Not all of your tables have data types for columns.</p>
</div>
<div class="paragraph">
<p>You will also need to build and run the CREATE TABLE statements for each of the tables, and run some queries to verify that everything is working correctly.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-17"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Use a text editor to open and review the <code>killrvideo.cql</code> file in the <code>labwork/exercise-16</code> directory. There are several tables with columns marked with <code>*CQL Type*</code>. Fill in the appropriate data type for the columns in <code>users_by_email</code>, <code>users</code>, <code>videos_by_user</code>, and <code>comments_by_user</code>.</p>
</div>
<div class="paragraph">
<p>2) In the <code>labwork/exercise-16</code> directory, start up <code>cqlsh</code>.</p>
</div>
<div class="paragraph">
<p>3) Run the SOURCE command on the <code>killrvideo.cql</code> file to execute the CREATE TABLE statements.</p>
</div>
<div class="paragraph">
<p>If the SOURCE command was successful, you should now have a new keyspace called <code>killr_video</code>.</p>
</div>
<div class="paragraph">
<p>4) Run the DESCRIBE KEYSPACE command on the <code>killr_video</code> keyspace to review the keyspace and table schema.</p>
</div>
<div class="paragraph">
<p>5) Set the default keyspace to <code>killr_video</code> with the USE command.</p>
</div>
<div class="paragraph">
<p>6) You can now load video data into your new keyspace. Use the COPY command to load data into the following tables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">videos.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;

COPY latest_videos <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">latest_videos.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;

COPY trailers_by_video <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">trailers_by_video.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;

COPY actors_by_video <span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">actors_by_video.csv</span><span class="delimiter">'</span></span> WITH HEADER=<span class="predefined-constant">true</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything is successful, you should now have video data available for reading.</p>
</div>
<div class="paragraph">
<p>7) Query the <code>latest_videos</code> table to find the most recent 50 videos that was uploaded.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is there a video uploaded for the movie Gone Girl? What is the <code>video_id</code> for that movie?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>8) Let&#8217;s find out some more information about this movie. Query the <code>videos</code> table using the previously found <code>video_id</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When was this movie released? What are the genres for this movie?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>9) We can also find the actors that were in the movie and the characters they played. Go ahead and query the <code>actors_by_video</code> table using the <code>video_id</code> for Gone Girl.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Who was the actor that played the character Desi Collings?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>10) At this point, an interested user might want to watch a trailer for this movie. Query the <code>trailers_by_video</code> table to check if there are any trailers available for this movie.</p>
</div>
<div class="paragraph">
<p>11) If there is a trailer available, make note of the <code>trailer_id</code> and then query the <code>videos</code> table again using the <code>trailer_id</code> value as the equality condition for the <code>video_id</code> column.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What is the URL for the trailer?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>12) Copy the URL into a web browser and enjoy!</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-02 09:10:17 -05:00
</div>
</div>
</body>
</html>